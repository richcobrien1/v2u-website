name: V2U Automation Trigger (Backup)

# NOTE: Primary automation now handled by Vercel Cron (runs hourly)
# This workflow serves as backup/manual trigger only
on:
  # Manual trigger only - Vercel Cron handles automatic scheduling
  workflow_dispatch:

jobs:
  trigger-automation:
    runs-on: ubuntu-latest
    
    steps:
      - name: Check for new content
        env:
          CRON_SECRET: ${{ secrets.CRON_SECRET }}
        run: |
          echo "Triggering content check..."
          response=$(curl -X GET "https://v2u.nexoai.com/api/automation/check" \
            -H "Content-Type: application/json" \
            -H "Authorization: Bearer ${CRON_SECRET}" \
            -H "User-Agent: github-actions-cron" \
            --tls-max 1.2 \
            --retry 2 \
            -w "\n%{http_code}" \
            --max-time 60 || echo "000")
          status_code=$(echo "$response" | tail -n1)
          body=$(echo "$response" | head -n-1)
          echo "HTTP Status: $status_code"
          if [ -n "$body" ]; then
            echo "Response: $body"
          fi
      
      - name: Post latest content
        env:
          CRON_SECRET: ${{ secrets.CRON_SECRET }}
        run: |
          echo "Triggering post-latest..."
          response=$(curl -X POST "https://v2u.nexoai.com/api/automation/post-latest" \
            -H "Content-Type: application/json" \
            -H "Authorization: Bearer ${CRON_SECRET}" \
            -H "User-Agent: github-actions-cron" \
            --tls-max 1.2 \
            --retry 2 \
            -w "\n%{http_code}" \
            --max-time 60 || echo "000")
          status_code=$(echo "$response" | tail -n1)
          body=$(echo "$response" | head -n-1)
          echo "HTTP Status: $status_code"
          if [ -n "$body" ]; then
            echo "Response: $body"
          fi
            -H "Content-Type: application/json" \
            -w "\n%{http_code}" \
            --max-time 60)
          status_code=$(echo "$response" | tail -n1)
          body=$(echo "$response" | head -n-1)
          echo "HTTP Status: $status_code"
          echo "Response: $body"
      
      - name: Complete
        run: echo "âœ… Automation trigger complete"
